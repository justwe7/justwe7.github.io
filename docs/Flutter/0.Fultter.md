## å­¦ä¹ æ—¥å¿—
åŸºç¡€æ¦‚å¿µçš„ç¬”è®°å¤§å¤šæ‘˜è‡ª[ç¬¬äºŒç‰ˆåº | ã€ŠFlutterå®æˆ˜Â·ç¬¬äºŒç‰ˆã€‹](https://book.flutterchina.club/)
ä¸ºä»€ä¹ˆéœ€è¦å†copyä¸€éï¼Ÿ
- è‡ªå·±ç”¨å¿ƒcvçš„ç¬”è®°æ‰èƒ½è®°å¾—ä½ğŸ¶
- é‡åˆ°ä¸€äº›ç–‘æƒ‘å¯ä»¥æ‰‹æ•²ä»£ç æˆ–æŸ¥é˜…èµ„æ–™åè¿›è¡Œæ ‡æ³¨
- åç»­å¼€å‘æ—¶åœ¨è‡ªå·±çš„ç¬”è®°ä¸­æŸ¥æ‰¾è¦æ›´å¿«ä¸€äº›

## åˆ›å»ºä¸€ä¸ªåŸºæœ¬å®ä¾‹
åŸºäºé¡¹ç›®æ ¹ç›®å½•çš„ `lib/main.dart`:
```dart
import 'package:flutter/material.dart'; // 1. å¼•å…¥æ§ä»¶

void main(List<String> args) { // 2.ç¨‹åºå…¥å£
  runApp(
    MaterialApp( // åº”ç”¨
      home: Home() // ä¸»é¡µ
    )
  ); // å¯åŠ¨åº”ç”¨
}

class Home extends StatelessWidget {
  // demo1 æ–‡æœ¬æ§ä»¶
  @override
  Widget build(BuildContext context) {
    return const Text('Hello World',
      style: TextStyle(
        fontSize: 30.0,
        color: Colors.blue,
      )
    );
  }
}
```
1. [MaterialÂ (opens new window)](https://material.io/guidelines/)æ˜¯ä¸€ç§æ ‡å‡†çš„ç§»åŠ¨ç«¯å’Œwebç«¯çš„è§†è§‰è®¾è®¡è¯­è¨€ï¼Œ Flutter é»˜è®¤æä¾›äº†ä¸€å¥—ä¸°å¯Œçš„ Material é£æ ¼çš„UIç»„ä»¶ã€‚
2. Flutter åº”ç”¨ä¸­ main å‡½æ•°ä¸ºåº”ç”¨ç¨‹åºçš„å…¥å£ã€‚main å‡½æ•°ä¸­è°ƒç”¨äº†runApp æ–¹æ³•ï¼Œå®ƒçš„åŠŸèƒ½æ˜¯å¯åŠ¨Flutteråº”ç”¨ã€‚runAppå®ƒæ¥å—ä¸€ä¸ª Widgetå‚æ•°ï¼Œåœ¨æœ¬ç¤ºä¾‹ä¸­å®ƒæ˜¯ä¸€ä¸ªMaterialAppå¯¹è±¡ï¼Œæ˜¯ Flutter åº”ç”¨çš„æ ¹ç»„ä»¶ã€‚

## é‡ç‚¹æ¦‚å¿µ
### `StatefulBuilder`å’Œ`Builder`
- ä½¿ç”¨`Builder`æ¥è·å–ä¸€ä¸ªåˆé€‚çš„ä¸Šä¸‹æ–‡ï¼Œç‰¹åˆ«æ˜¯åœ¨éœ€è¦ä¸€ä¸ªç‰¹å®šçš„ç¥–å…ˆwidgetçš„ä¸Šä¸‹æ–‡æ—¶ã€‚
- ä½¿ç”¨`StatefulBuilder`æ¥åœ¨æ— çŠ¶æ€çš„widgetä¸­å¼•å…¥å±€éƒ¨çŠ¶æ€ç®¡ç†ï¼Œç‰¹åˆ«æ˜¯åœ¨å¯¹è¯æ¡†æˆ–ä¸´æ—¶UIç»“æ„ä¸­ï¼Œè¿™æ ·ä½ å°±ä¸éœ€è¦å°†æ•´ä¸ªwidgetè½¬æ¢ä¸º`StatefulWidget`ã€‚
```dart
// `Builder`ä¸»è¦ç”¨äºè·å¾—æ­£ç¡®çš„ä¸Šä¸‹æ–‡ï¼Œç‰¹åˆ«æ˜¯å½“ä½ éœ€è¦çš„ä¸Šä¸‹æ–‡ä¸å½“å‰ä¸Šä¸‹æ–‡ä¸åŒæ—¶ï¼Œæ¯”å¦‚åœ¨`Scaffold`ä¸­ä½¿ç”¨`context`æ¥æ˜¾ç¤º`SnackBar`æ—¶
// `Builder`æä¾›äº†ä¸€ä¸ªæ–°çš„ä¸Šä¸‹æ–‡ï¼Œç”¨äº`ScaffoldMessenger.of(context)`æ¥æ‰¾åˆ°æœ€è¿‘çš„`Scaffold`ç¥–å…ˆ
Builder(
  builder: (BuildContext context) {
    return ElevatedButton(
      onPressed: () {
        ScaffoldMessenger.of(context).showSnackBar(SnackBar(
          content: Text('Hello from Builder'),
        ));
      },
      child: Text('Show SnackBar'),
    );
  },
)

// StatefulBuilder å¯ä»¥åœ¨ä¸€ä¸ªæ— çŠ¶æ€çš„widgetä¸­å¼•å…¥å±€éƒ¨çš„çŠ¶æ€ç®¡ç†ã€‚è¿™å¯¹äºåœ¨æ— çŠ¶æ€çš„å¯¹è¯æ¡†æˆ–åº•éƒ¨è¡¨å•ä¸­æ·»åŠ çŠ¶æ€éå¸¸æœ‰ç”¨ï¼Œè€Œä¸å¿…å°†æ•´ä¸ªwidgetè½¬æ¢ä¸º`StatefulWidget`ã€‚
// `StatefulBuilder`æä¾›äº†ä¸€ä¸ª`setState`å‡½æ•°ï¼Œä½ å¯ä»¥ä½¿ç”¨å®ƒæ¥æ›´æ–°å±€éƒ¨çŠ¶æ€ï¼ˆåœ¨è¿™ä¸ªä¾‹å­ä¸­æ˜¯å¤é€‰æ¡†çš„é€‰ä¸­çŠ¶æ€ï¼‰ï¼Œå¹¶ä¸”åªé‡å»ºåŒ…å«åœ¨`StatefulBuilder`ä¸­çš„widgetï¼Œè€Œä¸æ˜¯æ•´ä¸ªå¯¹è¯æ¡†
showDialog(
  context: context,
  builder: (BuildContext context) {
    bool isChecked = false;

    return StatefulBuilder(
      builder: (BuildContext context, StateSetter setState) {
        return AlertDialog(
          title: Text('StatefulBuilder Example'),
          content: CheckboxListTile(
            value: isChecked,
            title: Text('Check me!'),
            onChanged: (bool? value) {
              setState(() {
                isChecked = value!;
              });
            },
          ),
          actions: <Widget>[
            TextButton(
              child: Text('OK'),
              onPressed: () => Navigator.of(context).pop(),
            ),
          ],
        );
      },
    );
  },
);
```

### flutter blocå¥½è¿˜æ˜¯mvvmå¥½
Flutter BLoC æ˜¯ä¸€ç§å°†ä¸šåŠ¡é€»è¾‘ä»ç”¨æˆ·ç•Œé¢ä»£ç ä¸­åˆ†ç¦»å‡ºæ¥çš„æ–¹æ³•ï¼Œå¹¶ä½¿ç”¨Streamså’ŒRxDartåº“è¿›è¡Œæ•°æ®æµç®¡ç†ã€‚å®ƒå¾ˆé€‚åˆç”¨äºå¤„ç†å¤æ‚çš„ä¸šåŠ¡é€»è¾‘ï¼Œå¹¶åœ¨å¤šä¸ªåœ°æ–¹é‡ç”¨ä»£ç ã€‚

MVVMæ˜¯ä¸€ç§æ¶æ„æ¨¡å¼ï¼Œå…¶ä¸­â€œModelâ€ä»£è¡¨æ•°æ®æ¨¡å‹ï¼Œâ€œViewâ€ä»£è¡¨ç”¨æˆ·ç•Œé¢ï¼Œè€Œâ€œView Modelâ€åˆ™æ˜¯å°†æ•°æ®æ¨¡å‹ä¸ç”¨æˆ·ç•Œé¢åˆ†ç¦»çš„ä»£ç å±‚ã€‚å®ƒå¾ˆé€‚åˆç”¨äºç®€å•çš„ä¸šåŠ¡é€»è¾‘ï¼Œå¹¶ä¸”å¯ä»¥åœ¨è§†å›¾å’Œæ¨¡å‹é—´æä¾›åŒå‘ç»‘å®šã€‚

æ€»çš„æ¥è¯´ï¼Œå¦‚æœæ‚¨éœ€è¦å¤„ç†å¤æ‚çš„ä¸šåŠ¡é€»è¾‘ï¼Œåˆ™å¯ä»¥ä½¿ç”¨Flutter BLoCã€‚å¦‚æœæ‚¨éœ€è¦ç®€å•çš„ä¸šåŠ¡é€»è¾‘å¹¶å¸Œæœ›è§†å›¾å’Œæ¨¡å‹ä¹‹é—´æœ‰åŒå‘ç»‘å®šï¼Œåˆ™å¯ä»¥ä½¿ç”¨MVVMã€‚

## å¸¸è§éœ€æ±‚QA
### æ’‘æ»¡å®½åº¦ï¼Œå°±åƒdivé‚£æ ·
1. å°†`width`è®¾ç½®ä¸º`double.infinity`å¯ä»¥è®©ä¸€ä¸ªwidgetå°è¯•å¡«å……å…¶çˆ¶widgetæä¾›çš„æœ€å¤§å®½åº¦: `body: Container(color: Colors.blue, width: double.infinity, height: 50)`
2. `width`è®¾ç½®ä¸º`MediaQuery.of(context).size.width`
3. `Expanded`æ§ä»¶åŒ…è£¹ç›®æ ‡æ§ä»¶
### Xcodeæ¨¡æ‹Ÿå™¨å¤±è´¥Unable to boot the Simulator.
Open Xcode -> Preferences -> Locations -> Derived Data (Click the little arrow) -> Delete the folder.
![](../../static/docs/Pasted%20image%2020240219112345.png)
æ‰“å¼€è¯¥ç›®å½•åˆ é™¤ï¼Œé€šè¿‡xcodeå¯åŠ¨æ¨¡æ‹Ÿå™¨åï¼Œå†ç”¨vscodeè¿æ¥æ¨¡æ‹Ÿå™¨

### this.$forceUpdate()
åœ¨è°ƒç”¨`setState`æ–¹æ³•å`StatefulWidget`å°±ä¼šé‡æ–°buildï¼Œé‚£`setState`æ–¹æ³•åšäº†ä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬èƒ½ä¸èƒ½ä»ä¸­æ‰¾åˆ°æ–¹æ³•ï¼Ÿé¡ºç€è¿™ä¸ªæ€è·¯ï¼Œæˆ‘ä»¬å°±å¾—çœ‹ä¸€ä¸‹`setState`çš„æ ¸å¿ƒæºç ï¼š
```dart
void setState(VoidCallback fn) {
  ... //çœç•¥æ— å…³ä»£ç 
  _element.markNeedsBuild();
}
```
`markNeedsBuild` æ˜¯ Flutter æ¡†æ¶å†…éƒ¨ä½¿ç”¨çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºæ ‡è®°ä¸€ä¸ª `Widget` éœ€è¦é‡å»ºï¼ˆé‡æ–°æ„å»ºï¼‰ã€‚å½“ä¸€ä¸ª widget çš„çŠ¶æ€æ”¹å˜æ—¶ï¼ˆé€šå¸¸æ˜¯åœ¨çŠ¶æ€ç®¡ç†ä¸­ï¼Œå¦‚ä½¿ç”¨ `setState` æ–¹æ³•åï¼‰ï¼ŒFlutter ä¼šå°†è¯¥ widget æ ‡è®°ä¸º "éœ€è¦é‡å»º"ã€‚åœ¨ä¸‹ä¸€ä¸ªåŠ¨ç”»å¸§æ—¶ï¼ŒFlutter ä¼šé‡å»ºæ‰€æœ‰è¢«æ ‡è®°çš„ widgetï¼Œä»¥ç¡®ä¿å®ƒä»¬åæ˜ æœ€æ–°çš„çŠ¶æ€:
```dart
// åœ¨StateLessWidgetä¸­çš„AlertDialogä¸­æ·»åŠ éœ€è¦æ›´æ–°UIçŠ¶æ€çš„Checkbox (è¯¥æ–¹æ³•å¹¶éæœ€ä¼˜ï¼Œæ¨èä½¿ç”¨StatefulBuilder)
AlertDialog(
	title: Text("æç¤º"),
	content: Column(
	  crossAxisAlignment: CrossAxisAlignment.start,
	  mainAxisSize: MainAxisSize.min,
	  children: <Widget>[
		Text("æ‚¨ç¡®å®šè¦åˆ é™¤å½“å‰æ–‡ä»¶å—?"),
		Row(
		  children: <Widget>[
			Text("åŒæ—¶åˆ é™¤å­ç›®å½•ï¼Ÿ"),
			Checkbox( // ä¾ç„¶ä½¿ç”¨Checkboxç»„ä»¶
			  value: _withTree,
			  onChanged: (bool value) {
				// æ­¤æ—¶contextä¸ºå¯¹è¯æ¡†UIçš„æ ¹Elementï¼Œæˆ‘ä»¬ 
				// ç›´æ¥å°†å¯¹è¯æ¡†UIå¯¹åº”çš„Elementæ ‡è®°ä¸ºdirty
				(context as Element).markNeedsBuild();
				_withTree = !_withTree;
			  },
			),
		  ],
		),
	  ],
)
```

### æ­£åˆ™ä¸­çš„rå‰ç¼€
åœ¨Dartè¯­è¨€ä¸­ï¼Œæ­£åˆ™è¡¨è¾¾å¼ç”±`RegExp`ç±»è¡¨ç¤ºã€‚å½“ä½ çœ‹åˆ°ä»£ç ä¸­çš„`r`å‰ç¼€ï¼Œå®ƒè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªåŸå§‹å­—ç¬¦ä¸²ï¼ˆraw stringï¼‰ã€‚åœ¨Dartçš„åŸå§‹å­—ç¬¦ä¸²ä¸­ï¼Œé™¤äº†`\`å’Œ`$`ä¹‹å¤–ï¼Œå¤§å¤šæ•°ç‰¹æ®Šå­—ç¬¦å’Œè½¬ä¹‰åºåˆ—éƒ½è¢«å¿½ç•¥ï¼Œè¿™ä½¿å¾—ç¼–å†™å¤æ‚çš„æ­£åˆ™è¡¨è¾¾å¼æ›´åŠ å®¹æ˜“ï¼Œå› ä¸ºä½ ä¸éœ€è¦å¯¹åæ–œæ è¿›è¡Œè½¬ä¹‰ã€‚
ä¾‹å¦‚ï¼Œè€ƒè™‘ä»¥ä¸‹æ­£åˆ™è¡¨è¾¾å¼ï¼š
```dart
final RegExp regex = new RegExp(r'^1[3-9]\d{9}$');
```
åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼š
- `^` è¡¨ç¤ºåŒ¹é…å­—ç¬¦ä¸²çš„å¼€å§‹ã€‚
- `1` è¡¨ç¤ºåŒ¹é…æ•°å­—1ã€‚
- `[3-9]` æ˜¯ä¸€ä¸ªå­—ç¬¦é›†ï¼Œè¡¨ç¤ºåŒ¹é…ä»»ä½•åœ¨3åˆ°9ä¹‹é—´çš„å•ä¸ªæ•°å­—ã€‚
- `\d` æ˜¯ä¸€ä¸ªè½¬ä¹‰åºåˆ—ï¼Œè¡¨ç¤ºä»»æ„ä¸€ä¸ªæ•°å­—ï¼Œç­‰åŒäº `[0-9]`ã€‚
- `{9}` è¡¨ç¤ºå‰é¢çš„å…ƒç´ ï¼ˆåœ¨è¿™ä¸ªæƒ…å†µä¸‹æ˜¯æ•°å­—ï¼‰æ°å¥½é‡å¤9æ¬¡ã€‚
- `$` è¡¨ç¤ºåŒ¹é…å­—ç¬¦ä¸²çš„ç»“æŸã€‚
ç”±äºä½¿ç”¨äº†`r`å‰ç¼€ï¼Œæ‰€ä»¥åœ¨æ­£åˆ™è¡¨è¾¾å¼å†…éƒ¨çš„åæ–œæ `\`æ²¡æœ‰ç‰¹æ®Šå«ä¹‰ï¼Œå› æ­¤ä¸éœ€è¦ä½¿ç”¨é¢å¤–çš„åæ–œæ æ¥è¿›è¡Œè½¬ä¹‰ã€‚å¦‚æœæ²¡æœ‰ä½¿ç”¨`r`å‰ç¼€ï¼Œé‚£ä¹ˆä½ å¿…é¡»å¯¹æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„æ¯ä¸ªåæ–œæ è¿›è¡Œè½¬ä¹‰ï¼Œä¾‹å¦‚ä½¿ç”¨`\\d`æ¥è¡¨ç¤ºä¸€ä¸ªæ•°å­—ã€‚
ä½¿ç”¨åŸå§‹å­—ç¬¦ä¸²ï¼ˆ`r'...'`ï¼‰åœ¨å¤„ç†æ­£åˆ™è¡¨è¾¾å¼æ—¶éå¸¸æœ‰ç”¨ï¼Œç‰¹åˆ«æ˜¯å½“æ­£åˆ™è¡¨è¾¾å¼åŒ…å«è®¸å¤šç‰¹æ®Šå­—ç¬¦æˆ–è½¬ä¹‰åºåˆ—æ—¶ã€‚