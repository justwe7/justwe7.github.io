<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>å­¦ä¹ ç¬”è®°</title>
    <meta name="description" content="è®°å½•å¹³æ—¶æ‰€æ¥è§¦åˆ°çš„çŸ¥è¯†ç‚¹">
    
    
    <link rel="preload" href="blog/assets/css/0.styles.a0046fd7.css" as="style"><link rel="preload" href="blog/assets/js/app.e54586f3.js" as="script"><link rel="preload" href="blog/assets/js/2.d12215aa.js" as="script"><link rel="preload" href="blog/assets/js/30.b49ee00d.js" as="script"><link rel="prefetch" href="blog/assets/js/10.0d17d068.js"><link rel="prefetch" href="blog/assets/js/11.98e0198a.js"><link rel="prefetch" href="blog/assets/js/12.ae8539e1.js"><link rel="prefetch" href="blog/assets/js/13.685479be.js"><link rel="prefetch" href="blog/assets/js/14.671233cb.js"><link rel="prefetch" href="blog/assets/js/15.789cac6b.js"><link rel="prefetch" href="blog/assets/js/16.5762fa0d.js"><link rel="prefetch" href="blog/assets/js/17.3f6883fa.js"><link rel="prefetch" href="blog/assets/js/18.88f67ec2.js"><link rel="prefetch" href="blog/assets/js/19.1a3530fe.js"><link rel="prefetch" href="blog/assets/js/20.8d680bd2.js"><link rel="prefetch" href="blog/assets/js/21.5144d2b5.js"><link rel="prefetch" href="blog/assets/js/22.e3c85ce4.js"><link rel="prefetch" href="blog/assets/js/23.92888255.js"><link rel="prefetch" href="blog/assets/js/24.d6172d3a.js"><link rel="prefetch" href="blog/assets/js/25.b9fbc0ce.js"><link rel="prefetch" href="blog/assets/js/26.6eb10c76.js"><link rel="prefetch" href="blog/assets/js/27.b33dd473.js"><link rel="prefetch" href="blog/assets/js/28.5aa8acb9.js"><link rel="prefetch" href="blog/assets/js/29.fa356a69.js"><link rel="prefetch" href="blog/assets/js/3.a4ec70ce.js"><link rel="prefetch" href="blog/assets/js/31.d55e51ea.js"><link rel="prefetch" href="blog/assets/js/32.7e99701a.js"><link rel="prefetch" href="blog/assets/js/33.dcd1b177.js"><link rel="prefetch" href="blog/assets/js/34.cffd858f.js"><link rel="prefetch" href="blog/assets/js/4.841c7199.js"><link rel="prefetch" href="blog/assets/js/5.33cfe16c.js"><link rel="prefetch" href="blog/assets/js/6.9819231b.js"><link rel="prefetch" href="blog/assets/js/7.a37ec87a.js"><link rel="prefetch" href="blog/assets/js/8.8764dc37.js"><link rel="prefetch" href="blog/assets/js/9.2ba0bbda.js">
    <link rel="stylesheet" href="blog/assets/css/0.styles.a0046fd7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">å­¦ä¹ ç¬”è®°</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/justwe7/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/justwe7/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>åŸºç¡€æ¦‚å¿µ</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>å¹¿åº¦çŸ¥è¯†</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>æ·±åº¦çŸ¥è¯†</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/æ·±åº¦çŸ¥è¯†/chromeæ€§èƒ½.html" class="sidebar-link">chromeæ€§èƒ½</a></li><li><a href="/blog/æ·±åº¦çŸ¥è¯†/vueå®ç°åŸç†.html" class="sidebar-link">vueå®ç°åŸç†</a></li><li><a href="/blog/æ·±åº¦çŸ¥è¯†/vueç”Ÿå‘½å‘¨æœŸ.html" class="sidebar-link">vueç”Ÿå‘½å‘¨æœŸ</a></li><li><a href="/blog/æ·±åº¦çŸ¥è¯†/ä»0å¼€å§‹æ‰‹å†™ä¸€ä¸ªpromise.html" class="active sidebar-link">ä»0å¼€å§‹æ‰‹å†™ä¸€ä¸ªpromise</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/æ·±åº¦çŸ¥è¯†/å‰ç«¯æ€§èƒ½ä¼˜åŒ–.html" class="sidebar-link">å‰ç«¯æ€§èƒ½ä¼˜åŒ–</a></li><li><a href="/blog/æ·±åº¦çŸ¥è¯†/å‘å¸ƒè®¢é˜…æ¨¡å¼.html" class="sidebar-link">å‘å¸ƒè®¢é˜…æ¨¡å¼</a></li><li><a href="/blog/æ·±åº¦çŸ¥è¯†/æ­£åˆ™é€ŸæŸ¥è¡¨.html" class="sidebar-link">æ­£åˆ™é€ŸæŸ¥è¡¨</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>é¦–å…ˆå›å¿†ä¸€ä¸‹promiseä½¿ç”¨ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'success'</span><span class="token operator">+</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'fail'</span><span class="token operator">+</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="åˆ†æï¼š"><a href="#åˆ†æï¼š" class="header-anchor">#</a> åˆ†æï¼š</h3> <ol><li>new Promise(fn),é¦–å…ˆå®ä¾‹åŒ–äº†ä¸€ä¸ªåä¸ºpromiseçš„æ„é€ å‡½æ•°ï¼Œä¼ å…¥äº†ä¸€ä¸ªæ–¹æ³•: fn
<ol><li>fnæ¥æ”¶ä¸¤ä¸ªå½¢å‚ï¼šresolveï¼Œreject</li> <li>fnå‡½æ•°ä½“å†…ä»£ç æ‰§è¡Œï¼Œå¼‚æ­¥ä»£ç æ‰§è¡Œå®Œæˆï¼Œæ‰§è¡Œæ¥æ”¶çš„å®å‚resolve/reject</li></ol></li> <li>æ‰§è¡Œpromiseé“¾ä¸Šçš„thenæ–¹æ³•ï¼Œä¼ å…¥ä¸¤ä¸ªæ–¹æ³•ä½œä¸ºå®å‚ p.then(successFn, failFn)</li> <li>successFn/failFnæœ‰ä¸€ä¸ªæ–¹æ³•ä¼šæ‰§è¡Œï¼Œåˆ¤æ–­ä¾æ®æ˜¯è°ƒç”¨äº†resolveè¿˜æ˜¯reject</li></ol> <h3 id="lowç‰ˆå®ç°ï¼š"><a href="#lowç‰ˆå®ç°ï¼š" class="header-anchor">#</a> lowç‰ˆå®ç°ï¼š</h3> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token keyword">class</span> <span class="token class-name">P</span> <span class="token punctuation">{</span>
      <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">runFn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//æ„é€ å‡½æ•°é»˜è®¤æ‰§è¡Œ</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">;</span><span class="token comment">//å£°æ˜é»˜è®¤çŠ¶æ€</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token comment">//å£°æ˜ä¸€ä¸ªé—­åŒ…å˜é‡ </span>
        <span class="token keyword">let</span> <span class="token function-variable function">resolve</span> <span class="token operator">=</span> <span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token comment">//æ‰§è¡Œå‡½æ•°ä½“æ›´æ”¹çŠ¶æ€çš„å®å‚  --- æ›´æ”¹å†…éƒ¨çš„çŠ¶æ€  æ¥æ”¶æ‰§è¡Œæ›´æ”¹çŠ¶æ€ä¼ å…¥çš„å®å‚</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">'pending'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//çŠ¶æ€åªèƒ½æ›´æ”¹ä¸€æ¬¡  é»˜è®¤çŠ¶æ€æ‰èƒ½æ›´æ”¹</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token string">'fulfilled'</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> res
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">let</span> <span class="token function-variable function">reject</span> <span class="token operator">=</span> <span class="token parameter">rej</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">'pending'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token string">'rejected'</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> rej
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token function">runFn</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token comment">//æ‰§è¡Œå‡½æ•°ä½“  ä¼ å…¥ä¸¤ä¸ªæ›´æ”¹çŠ¶æ€çš„å‚æ•°</span>
      <span class="token punctuation">}</span>
      <span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">resolveFn<span class="token punctuation">,</span> rejectFn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//promise().then(fn1, fn2)æ¥æ”¶çš„ä¸¤ä¸ªå›è°ƒ </span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//åˆ¤æ–­çŠ¶æ€æ‰§è¡Œä¸åŒå›è°ƒ</span>
          <span class="token keyword">case</span> <span class="token string">&quot;fulfilled&quot;</span><span class="token operator">:</span>
            <span class="token function">resolveFn</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token comment">// å°†æ‰§è¡Œå‡½æ•°ä½“ æ›´æ”¹çŠ¶æ€å€¼æ—¶çš„å½¢å‚ä½œä¸ºå®å‚ä¼ å…¥å›è°ƒ</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
          <span class="token keyword">case</span> <span class="token string">&quot;rejected&quot;</span><span class="token operator">:</span>
            <span class="token function">rejectFn</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        
          <span class="token keyword">default</span><span class="token operator">:</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>å¤§æ¦‚ç”¨èµ·æ¥å¥½åƒæ˜¯æ²¡ä»€ä¹ˆæ¯›ç—…äº†ã€‚ã€‚ã€‚ä½†æ˜¯ï¼ï¼ï¼(å°±æ€•ä½†æ˜¯ğŸ˜­)</p> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token keyword">new</span> <span class="token class-name">P</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// resolve(1234)</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// !!! è¿™æ ·å®ç°æœ‰ä¸ªé—®é¢˜  å…ˆæ‰§è¡Œthenæ–¹æ³•æ˜¯æ— æ³•æ‰§è¡Œå†…éƒ¨æ›´æ”¹çŠ¶æ€çš„æ–¹æ³•çš„</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1234</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>å¦‚æœpromiseä¼ å…¥fnæ‰§è¡ŒçœŸçš„æ˜¯å¼‚æ­¥æ¥æ›´æ”¹çŠ¶æ€çš„ï¼Œå¯èƒ½å°±æ˜¯:<br>
promise =&gt; fn() =&gt; then() =&gt; resolve/rejectã€‚<br>
å‡è®¾ç”¨setTimeoutæ¥æ¨¡æ‹Ÿå¼‚æ­¥ï¼Œå¯ä»¥çŸ¥é“<em>setTimeoutä½œä¸ºå®ä»»åŠ¡æ˜¯åœ¨ä¸‹ä¸€è½®çš„event Loop</em>æ‰§è¡Œæ ˆä¸­æ¥æ‰§è¡Œçš„ï¼Œè€Œ<strong>thenæ–¹æ³•</strong>å±äºè°ƒç”¨Pæ„é€ å‡½æ•°å†…çš„ä¸€ä¸ªæ–¹æ³•ï¼Œæ‰€ä»¥<strong>ä¼šå…ˆäºresolve/reject</strong>çŠ¶æ€æ›´æ”¹æ‰§è¡Œï¼Œå†…éƒ¨ä¹Ÿå°±è¿˜æ˜¯pendingçŠ¶æ€ã€‚</p> <p><strong>è§£å†³çœŸÂ·å¼‚æ­¥çš„é—®é¢˜ï¼š</strong>
å€Ÿé‰´<a href="https://lihx.top/shi-yao-shi-fa-bu-ding-yue-mo-shi/" target="_blank" rel="noopener noreferrer">å‘å¸ƒè®¢é˜…æ¨¡å¼<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>çš„æ€è·¯ï¼šå¦‚æœ<strong>æ‰§è¡Œthençš„æ—¶å€™æ²¡æœ‰è¿›å…¥ç»“æŸ</strong>çŠ¶æ€ï¼Œå¯ä»¥åœ¨Pä¸­è®¢é˜…ä¸€ä¸ªç»ˆæ­¢çš„çŠ¶æ€(åŒ…æ‹¬æˆåŠŸå’Œå¤±è´¥)ä¼ å…¥è¦æ‰§è¡Œçš„æ–¹æ³•ï¼Œç„¶ååœ¨å¼‚æ­¥ç»“æŸçŠ¶æ€çš„æ—¶å€™æ›´æ”¹çŠ¶æ€æ—¶å€™(è¿™ç§æƒ…å†µ--å¾ˆç®€å•ä½¿ç”¨å…¶å®å†…éƒ¨çŠ¶æ€å·²ç»æ²¡æœ‰å½±å“äº†)ï¼Œresolve/rejectæ–¹æ³•å†…éƒ¨å°†åˆ†åˆ«<strong>è®¢é˜…çš„ä»»åŠ¡åˆ—è¡¨ä¸­çš„æ–¹æ³•éå†æ‰§è¡Œ</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>   <span class="token comment">/* 
      é¡ºåºåº”è¯¥æ˜¯ 
      å¦‚æœæ‰§è¡Œthenæ—¶çŠ¶æ€è¿˜æ˜¯ pending å…ˆè®¢é˜… å°†å°†è¦æ‰§è¡Œçš„æ–¹æ³•ä¼ å…¥è®¢é˜…åˆ—è¡¨
      çŠ¶æ€æ›´æ”¹å æ‰§è¡Œå‘å¸ƒ æ‰§è¡Œè®¢é˜…é˜Ÿåˆ—çš„æ–¹æ³• ï¼ˆå‘å¸ƒè®¢é˜…çš„æ‹†è§£ï¼‰
    */</span>
  <span class="token keyword">class</span> <span class="token class-name">P</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">runFn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">;</span> <span class="token comment">//å£°æ˜é»˜è®¤çŠ¶æ€</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span> <span class="token comment">//å£°æ˜ä¸€ä¸ªé—­åŒ…å˜é‡</span>

      <span class="token keyword">this</span><span class="token punctuation">.</span>onResolvedCallbacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//æˆåŠŸçš„è®¢é˜…åˆ—è¡¨  -- è§£å†³å¼‚æ­¥thené—®é¢˜</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallbacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//å¤±è´¥çš„</span>
      <span class="token keyword">let</span> <span class="token function-variable function">resolve</span> <span class="token operator">=</span> <span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">//æ‰§è¡Œå‡½æ•°ä½“æ›´æ”¹çŠ¶æ€çš„å®å‚  --- æ›´æ”¹å†…éƒ¨çš„çŠ¶æ€  æ¥æ”¶æ‰§è¡Œæ›´æ”¹çŠ¶æ€ä¼ å…¥çš„å®å‚</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">//çŠ¶æ€åªèƒ½æ›´æ”¹ä¸€æ¬¡  é»˜è®¤çŠ¶æ€æ‰èƒ½æ›´æ”¹</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token string">&quot;fulfilled&quot;</span><span class="token punctuation">;</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> res<span class="token punctuation">;</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>onResolvedCallbacks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">cb</span> <span class="token operator">=&gt;</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> <span class="token function-variable function">reject</span> <span class="token operator">=</span> <span class="token parameter">rej</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token string">&quot;rejected&quot;</span><span class="token punctuation">;</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> rej<span class="token punctuation">;</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallbacks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">cb</span> <span class="token operator">=&gt;</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token function">runFn</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//æ‰§è¡Œå‡½æ•°ä½“  ä¼ å…¥ä¸¤ä¸ªæ›´æ”¹çŠ¶æ€çš„å‚æ•°</span>
    <span class="token punctuation">}</span>
    <span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">resolveFn<span class="token punctuation">,</span> rejectFn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">switch</span> <span class="token punctuation">(</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token comment">//åˆ¤æ–­çŠ¶æ€æ‰§è¡Œä¸åŒå›è°ƒ</span>
      <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token string">&quot;fulfilled&quot;</span><span class="token operator">:</span>
          <span class="token function">resolveFn</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å°†æ‰§è¡Œå‡½æ•°ä½“ æ›´æ”¹çŠ¶æ€å€¼æ—¶çš„å½¢å‚ä½œä¸ºå®å‚ä¼ å…¥å›è°ƒ</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token string">&quot;rejected&quot;</span><span class="token operator">:</span>
          <span class="token function">rejectFn</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>

        <span class="token keyword">default</span><span class="token operator">:</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>onResolvedCallbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">resolveFn</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">rejectFn</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><h3 id="è¾ƒä¸ºå®Œå–„å®ç°"><a href="#è¾ƒä¸ºå®Œå–„å®ç°" class="header-anchor">#</a> è¾ƒä¸ºå®Œå–„å®ç°</h3> <p>æ—¥å¸¸æ›´å¤šç”¨åˆ°çš„å†™æ³•å¯èƒ½æ˜¯é“¾å¼è°ƒç”¨ï¼Œè€Œä¸æ˜¯åœ¨thené‡Œé¢ä¼ å…¥ä¸¤ä¸ªçŠ¶æ€å›è°ƒï¼Œè€Œä¸”ï¼ï¼ï¼<strong>promiseæ˜¯æ”¯æŒé“¾å¼</strong>è°ƒç”¨çš„new P().then().then().catch()ã€‚
çœ‹çœ‹å¹³å¸¸æ€ä¹ˆå†™</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'aasdfgfdgå“ˆå“ˆå“ˆæˆ‘ä¸“é—¨çš„'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token operator">++</span>res
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// ---------------------------</span>

<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token operator">++</span>res
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  aasdfgfdgå“ˆå“ˆå“ˆæˆ‘ä¸“é—¨çš„
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>å¯ä»¥çœ‹åˆ°åŒºåˆ«ï¼š</p> <ol><li>thenå¯ä»¥ä¸ä¼ ä¸¤ä¸ªå‚æ•°ã€‚(å¤„ç†ä¸€ä¸‹resolveFnï¼ŒrejectFn)</li> <li>thenä¹‹åè¿˜å¯ä»¥thenï¼Œè¯´æ˜åº”è¯¥thenåº”è¯¥æ˜¯æœ‰ä¸€ä¸ªè¿”å›çš„å‡½æ•° æŸ¯é‡ŒåŒ– (thenæ–¹æ³•åº”è¯¥èƒ½è¿”å›ä¸€ä¸ªæ–°çš„P)</li> <li>rejectå¯ä»¥ç›´æ¥è·³æ¥¼åˆ°catchæ–¹æ³•</li> <li>catchå¯ä»¥æ•è·åˆ°thenæ‰§è¡Œå¤±è´¥çš„ä»£ç (å¦‚ä½•æ•è·ä»£ç å‘¢ï¼Ÿtry catch)</li></ol></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/justwe7/blog/edit/feature/docs/æ·±åº¦çŸ¥è¯†/ä»0å¼€å§‹æ‰‹å†™ä¸€ä¸ªpromise.md" target="_blank" rel="noopener noreferrer">çº æ­£é”™è¯¯</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">æœ€è¿‘æäº¤:</span> <span class="time">1/13/2020, 2:41:37 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/blog/æ·±åº¦çŸ¥è¯†/vueç”Ÿå‘½å‘¨æœŸ.html" class="prev">vueç”Ÿå‘½å‘¨æœŸ</a></span> <span class="next"><a href="/blog/æ·±åº¦çŸ¥è¯†/å‰ç«¯æ€§èƒ½ä¼˜åŒ–.html">å‰ç«¯æ€§èƒ½ä¼˜åŒ–</a>
      â†’
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="blog/assets/js/app.e54586f3.js" defer></script><script src="blog/assets/js/2.d12215aa.js" defer></script><script src="blog/assets/js/30.b49ee00d.js" defer></script>
  </body>
</html>
