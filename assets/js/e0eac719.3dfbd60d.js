"use strict";(self.webpackChunkjustwe7_books=self.webpackChunkjustwe7_books||[]).push([[4483],{3905:(e,n,r)=>{r.d(n,{Zo:()=>i,kt:()=>d});var t=r(67294);function a(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function o(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,t)}return r}function s(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?o(Object(r),!0).forEach((function(n){a(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}function m(e,n){if(null==e)return{};var r,t,a=function(e,n){if(null==e)return{};var r,t,a={},o=Object.keys(e);for(t=0;t<o.length;t++)r=o[t],n.indexOf(r)>=0||(a[r]=e[r]);return a}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(t=0;t<o.length;t++)r=o[t],n.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var c=t.createContext({}),l=function(e){var n=t.useContext(c),r=n;return e&&(r="function"==typeof e?e(n):s(s({},n),e)),r},i=function(e){var n=l(e.components);return t.createElement(c.Provider,{value:n},e.children)},p="mdxType",k={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},u=t.forwardRef((function(e,n){var r=e.components,a=e.mdxType,o=e.originalType,c=e.parentName,i=m(e,["components","mdxType","originalType","parentName"]),p=l(r),u=a,d=p["".concat(c,".").concat(u)]||p[u]||k[u]||o;return r?t.createElement(d,s(s({ref:n},i),{},{components:r})):t.createElement(d,s({ref:n},i))}));function d(e,n){var r=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var o=r.length,s=new Array(o);s[0]=u;var m={};for(var c in n)hasOwnProperty.call(n,c)&&(m[c]=n[c]);m.originalType=e,m[p]="string"==typeof e?e:a,s[1]=m;for(var l=2;l<o;l++)s[l]=r[l];return t.createElement.apply(null,s)}return t.createElement.apply(null,r)}u.displayName="MDXCreateElement"},68698:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>i,contentTitle:()=>c,default:()=>u,frontMatter:()=>m,metadata:()=>l,toc:()=>p});var t=r(87462),a=r(63366),o=(r(67294),r(3905));const s=["components"],m={},c=void 0,l={unversionedId:"\u524d\u7aef\u5de5\u7a0b\u5316/\u4f7f\u7528msw\u7ed3\u5408faker\u521b\u5efamock\u670d\u52a1",id:"\u524d\u7aef\u5de5\u7a0b\u5316/\u4f7f\u7528msw\u7ed3\u5408faker\u521b\u5efamock\u670d\u52a1",title:"\u4f7f\u7528msw\u7ed3\u5408faker\u521b\u5efamock\u670d\u52a1",description:"\u4ec0\u4e48\u662fmsw",source:"@site/docs/\u524d\u7aef\u5de5\u7a0b\u5316/\u4f7f\u7528msw\u7ed3\u5408faker\u521b\u5efamock\u670d\u52a1.md",sourceDirName:"\u524d\u7aef\u5de5\u7a0b\u5316",slug:"/\u524d\u7aef\u5de5\u7a0b\u5316/\u4f7f\u7528msw\u7ed3\u5408faker\u521b\u5efamock\u670d\u52a1",permalink:"/docs/\u524d\u7aef\u5de5\u7a0b\u5316/\u4f7f\u7528msw\u7ed3\u5408faker\u521b\u5efamock\u670d\u52a1",draft:!1,editUrl:"https://github.com/justwe7/justwe7.github.io/blob/feature/docs/\u524d\u7aef\u5de5\u7a0b\u5316/\u4f7f\u7528msw\u7ed3\u5408faker\u521b\u5efamock\u670d\u52a1.md",tags:[],version:"current",frontMatter:{},sidebar:"defaultSidebar",previous:{title:"webpack\u6784\u5efa\u5206\u6790",permalink:"/docs/\u524d\u7aef\u5de5\u7a0b\u5316/webpack\u6784\u5efa\u5206\u6790"},next:{title:"iOS\u4f01\u4e1a\u5f00\u53d1\u8005\u8d26\u53f7\u7533\u8bf7",permalink:"/docs/\u6280\u672f\u6742\u9879/iOS\u4f01\u4e1a\u5f00\u53d1\u8005\u8d26\u53f7\u7533\u8bf7"}},i={},p=[{value:"\u4ec0\u4e48\u662fmsw",id:"\u4ec0\u4e48\u662fmsw",level:2},{value:"\u6dfb\u52a0\u5230\u9879\u76ee\u4e2d",id:"\u6dfb\u52a0\u5230\u9879\u76ee\u4e2d",level:2},{value:"\u4e00\u3001 \u5b89\u88c5",id:"\u4e00-\u5b89\u88c5",level:3},{value:"\u4e8c\u3001\u521b\u5efa mock handler\uff0c\u56e0\u4e1a\u52a1\u63a5\u53e3\u6b63\u5e38\u90fd\u4f1a\u6709\u89c4\u8303\uff0c\u521b\u5efa\u4e00\u4e2a\u65b9\u6cd5\u7528\u4e8e\u751f\u6210RESTful\u63a5\u53e3\u54cd\u5e94\u4f53",id:"\u4e8c\u521b\u5efa-mock-handler\u56e0\u4e1a\u52a1\u63a5\u53e3\u6b63\u5e38\u90fd\u4f1a\u6709\u89c4\u8303\u521b\u5efa\u4e00\u4e2a\u65b9\u6cd5\u7528\u4e8e\u751f\u6210restful\u63a5\u53e3\u54cd\u5e94\u4f53",level:3},{value:"\u4e09\u3001\u8bbe\u7f6e mock service worker",id:"\u4e09\u8bbe\u7f6e-mock-service-worker",level:3},{value:"\u56db\u3001\u751f\u6210<code>mockServiceWorker.js</code>\u5230\u9759\u6001\u8d44\u6e90\u76ee\u5f55\u4e0b",id:"\u56db\u751f\u6210mockserviceworkerjs\u5230\u9759\u6001\u8d44\u6e90\u76ee\u5f55\u4e0b",level:3},{value:"\u4e94\u3001\u5728\u5e94\u7528\u8fd0\u884c\u524d\u6ce8\u518c\uff0c",id:"\u4e94\u5728\u5e94\u7528\u8fd0\u884c\u524d\u6ce8\u518c",level:3},{value:"\u4f7f\u7528faker\u5927\u9b54\u738b\u52a8\u6001\u751f\u6210mock\u5185\u5bb9",id:"\u4f7f\u7528faker\u5927\u9b54\u738b\u52a8\u6001\u751f\u6210mock\u5185\u5bb9",level:2},{value:"\u4e0emsw\u96c6\u6210\uff0c\u5e76\u8bbe\u7f6e\u751f\u6210\u4e2d\u6587mock\u6570\u636e",id:"\u4e0emsw\u96c6\u6210\u5e76\u8bbe\u7f6e\u751f\u6210\u4e2d\u6587mock\u6570\u636e",level:3}],k={toc:p};function u(e){let{components:n}=e,r=(0,a.Z)(e,s);return(0,o.kt)("wrapper",(0,t.Z)({},k,r,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"\u4ec0\u4e48\u662fmsw"},"\u4ec0\u4e48\u662fmsw"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://mswjs.io/"},"MSW (Mock Service Worker) "),"\u662f\u76ee\u524d\u975e\u5e38\u63a8\u8350\u7684\u524d\u7aef mock \u5de5\u5177\uff0c\u5b83\u901a\u8fc7\u62e6\u622a ",(0,o.kt)("inlineCode",{parentName:"p"},"fetch")," / ",(0,o.kt)("inlineCode",{parentName:"p"},"XHR")," \u8bf7\u6c42\u6765\u8fd4\u56de mock \u6570\u636e\uff0c\u5b8c\u5168\u6a21\u62df\u771f\u5b9e\u8bf7\u6c42\u884c\u4e3a\u3002"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"\u4f18\u70b9\uff1a")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u62e6\u622a\u771f\u5b9e\u7f51\u7edc\u8bf7\u6c42\uff0c\u65e0\u9700\u66f4\u6539\u4e1a\u52a1\u4ee3\u7801    "),(0,o.kt)("li",{parentName:"ul"},"\u652f\u6301\u5f00\u53d1\u73af\u5883\u4e0e\u6d4b\u8bd5\u73af\u5883 mock    "),(0,o.kt)("li",{parentName:"ul"},"\u652f\u6301 REST \u548c GraphQL    "),(0,o.kt)("li",{parentName:"ul"},"\u53ef\u4ee5\u6309\u9700\u542f\u7528/\u7981\u7528    "),(0,o.kt)("li",{parentName:"ul"},"\u65e0\u9700\u4fee\u6539 API \u8bf7\u6c42\u5730\u5740")),(0,o.kt)("h2",{id:"\u6dfb\u52a0\u5230\u9879\u76ee\u4e2d"},"\u6dfb\u52a0\u5230\u9879\u76ee\u4e2d"),(0,o.kt)("p",null,'\u5728\u57fa\u4e8eCRA@5\u521b\u5efa\u7684react\u9879\u76ee\u4e2d\u914d\u7f6e\uff0c\u672c\u6587\u6863\u57fa\u4e8e"msw": "^2.9.0"\u7f16\u5199'),(0,o.kt)("h3",{id:"\u4e00-\u5b89\u88c5"},"\u4e00\u3001 \u5b89\u88c5"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"npm install msw --save-dev\n")),(0,o.kt)("h3",{id:"\u4e8c\u521b\u5efa-mock-handler\u56e0\u4e1a\u52a1\u63a5\u53e3\u6b63\u5e38\u90fd\u4f1a\u6709\u89c4\u8303\u521b\u5efa\u4e00\u4e2a\u65b9\u6cd5\u7528\u4e8e\u751f\u6210restful\u63a5\u53e3\u54cd\u5e94\u4f53"},"\u4e8c\u3001\u521b\u5efa mock handler\uff0c\u56e0\u4e1a\u52a1\u63a5\u53e3\u6b63\u5e38\u90fd\u4f1a\u6709\u89c4\u8303\uff0c\u521b\u5efa\u4e00\u4e2a\u65b9\u6cd5\u7528\u4e8e\u751f\u6210RESTful\u63a5\u53e3\u54cd\u5e94\u4f53"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"// src/mocks/handlers.js\nimport { http } from 'msw'\nimport createResponse from './createResponse'\n\nexport const handlers = [\n  // \u586b\u5199\u9700\u8981mock\u7684\u63a5\u53e3\uff0c\u5982handlers\u672a\u5339\u914d\u9879\u76ee\u5219\u4f1a\u53d1\u8d77\u771f\u5b9ehttp\u8bf7\u6c42\u3002path\u652f\u6301http\u534f\u8bae\u5168\u8def\u5f84\n  http.post(`/api/index`, () => {\n    return createResponse({\n      id: 1\n    })\n  }),\n]\n\n// src/mocks/createResponse.js\nimport { HttpResponse } from 'msw'\n\nexport default async function createResponse (data, delay = 300) {\n  await new Promise((resolve) => {\n    setTimeout(resolve, delay)\n  })\n  return HttpResponse.json({\n    status: 0,\n    message: '\u6210\u529f',\n    content: data,\n  })\n}\n")),(0,o.kt)("h3",{id:"\u4e09\u8bbe\u7f6e-mock-service-worker"},"\u4e09\u3001\u8bbe\u7f6e mock service worker"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"// src/mocks/inject.js\nimport { setupWorker } from 'msw/browser'\nimport { handlers } from './handlers'\n\nexport const worker = setupWorker(...handlers)\n")),(0,o.kt)("h3",{id:"\u56db\u751f\u6210mockserviceworkerjs\u5230\u9759\u6001\u8d44\u6e90\u76ee\u5f55\u4e0b"},"\u56db\u3001\u751f\u6210",(0,o.kt)("inlineCode",{parentName:"h3"},"mockServiceWorker.js"),"\u5230\u9759\u6001\u8d44\u6e90\u76ee\u5f55\u4e0b"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"npx msw init public/ --save\n\n// \u786e\u8ba4\u751f\u6210\u540e\u7684\u6587\u4ef6\u5b58\u5728\nyour-project/\n\u251c\u2500\u2500 public/\n\u2502   \u251c\u2500\u2500 index.html\n\u2502   \u2514\u2500\u2500 mockServiceWorker.js \u2705\n\u251c\u2500\u2500 src/\n\u2502   \u2514\u2500\u2500 mocks/\n")),(0,o.kt)("h3",{id:"\u4e94\u5728\u5e94\u7528\u8fd0\u884c\u524d\u6ce8\u518c"},"\u4e94\u3001\u5728\u5e94\u7528\u8fd0\u884c\u524d\u6ce8\u518c\uff0c"),(0,o.kt)("p",null,"\u6ce8\u610f\u9879\u76ee\u4e2d\u914d\u7f6e\u7684",(0,o.kt)("inlineCode",{parentName:"p"},"PUBLIC_URL"),"\u53d8\u91cf\uff0c\u5982\u6709\u914d\u7f6e\u9700\u8981\u660e\u6587\u6307\u5b9a\u8def\u5f84\u3002\u540c\u65f6\u6dfb\u52a0\u4e00\u4e2a\u5f00\u5173\u662f\u5426\u9700\u8981\u542f\u7528mock"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"PUBLIC_URL=/m/\nREACT_APP_API_MOCK=true\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"// \u5f00\u542fmock\u670d\u52a1\nif (process.env.REACT_APP_API_MOCK === 'true') {\n  // eslint-disable-next-line @typescript-eslint/no-var-requires\n  const { worker } = require('./mocks/inject.js')\n  worker.start({\n    serviceWorker: {\n      url: `${process.env.PUBLIC_URL}/mockServiceWorker.js`, // \ud83d\udc48 \u624b\u52a8\u6307\u5b9a\u8def\u5f84\n    },\n  })\n}\n")),(0,o.kt)("p",null,"\u5982\u679c\u6709\u9047\u5230\u8bf7\u6c42\u7684\u63a5\u53e3\u76f4\u63a5\u88ab302\u91cd\u5b9a\u5411\u5e76\u8fd4\u56deindex.html\u7684\u5185\u5bb9\uff0c",(0,o.kt)("inlineCode",{parentName:"p"},"config/webpackDevServer.config.js"),"\u5220\u9664\u91cd\u5b9a\u5411\u903b\u8f91"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"onAfterSetupMiddleware(devServer) {\n  // Redirect to `PUBLIC_URL` or `homepage` from `package.json` if url not match\n  // \u7981\u6b62\u5f00\u53d1\u73af\u5883\u81ea\u52a8\u91cd\u5b9a\u5411\u5230\u9996\u9875\n  // devServer.app.use(redirectServedPath(paths.publicUrlOrPath));\n  // ...\n},\n")),(0,o.kt)("h2",{id:"\u4f7f\u7528faker\u5927\u9b54\u738b\u52a8\u6001\u751f\u6210mock\u5185\u5bb9"},"\u4f7f\u7528faker\u5927\u9b54\u738b\u52a8\u6001\u751f\u6210mock\u5185\u5bb9"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://github.com/faker-js/faker"},(0,o.kt)("inlineCode",{parentName:"a"},"faker")," "),"\u662f\u4e1a\u754c\u4e3b\u6d41\u7684\u968f\u673a\u6570\u636e\u751f\u6210\u5e93\uff0cMSW \u53ef\u4ee5\u4e0e\u5b83\u65e0\u7f1d\u642d\u914d"),(0,o.kt)("p",null,"\u5b89\u88c5"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"npm install @faker-js/faker --save-dev\n")),(0,o.kt)("h3",{id:"\u4e0emsw\u96c6\u6210\u5e76\u8bbe\u7f6e\u751f\u6210\u4e2d\u6587mock\u6570\u636e"},"\u4e0emsw\u96c6\u6210\uff0c\u5e76\u8bbe\u7f6e\u751f\u6210\u4e2d\u6587mock\u6570\u636e"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"// src/mocks/handlers.js\nimport { http } from 'msw'\n// eslint-disable-next-line camelcase\nimport { Faker, zh_CN } from '@faker-js/faker'\nimport createResponse from './createResponse'\n// eslint-disable-next-line camelcase\nconst mock = new Faker({ locale: [zh_CN] })\nconst baseURL = process.env.REACT_APPAPI_ROOT\n\nexport const handlers = [\n\n  // \u8d26\u5355\u5217\u8868\n  http.post(`${baseURL}/list`, () => {\n    return createResponse({\n      loanList: Array.from({ length: mock.number.int({ min: 0, max: 5 }) }, () => ({\n        loanGid: mock.string.uuid(),\n        productType: mock.number.int({ min: 1, max: 2 }),\n        exceedDays: mock.number.int({ min: -10, max: 15 }),\n        status: mock.helpers.arrayElement([0, 1, 3, 21]),\n        repayStatus: mock.number.int({ min: 1, max: 3 }),\n        loanAmount: mock.number.int({ min: 10000, max: 100000 }),\n        loanLeftAmount: mock.number.int({ min: 10000, max: 100000 }),\n        repayLeftSubNum: mock.number.int({ min: 1, max: 3 }),\n        repayLeftAmount: mock.number.int({ min: 10000, max: 100000 }),\n        loanTime: mock.date.recent().getTime(),\n        dueTime: mock.date.recent().getTime(),\n        // privilegeInfo: {\n        //   forwardLeftAmount: mock.number.int({ min: 10000, max: 100000 }),\n        //   privilegeDesc: mock.commerce.productName(),\n        //   isOverdue: mock.helpers.arrayElement([true, false]),\n        //   dueTime: mock.date.recent().getTime()\n        // },\n        partnerProduct: {\n          rateType: mock.number.int({ min: 1, max: 2 }),\n          loanRate: mock.number.int({ min: 1, max: 10 }),\n          logoUrl: mock.image.url(),\n          apiChannel: mock.helpers.arrayElement([10001, 50001, 50002]), // \u968f\u673a\u751f\u6210\u4e00\u4e2a\u6570\u7ec4\uff0c\u6570\u7ec4\u5143\u7d20\u4e3a 10001\u300120002\u300110003 \u4e2d\u7684\u4e00\u4e2a,\n          loanTerms: [1, 2, 3],\n          period: mock.number.int({ min: 1, max: 12 })\n        }\n      }))\n    })\n  }),\n\n\n  // \n  http.post(`${baseURL}/api/:id`, () => {\n    return createResponse({\n      productType: 56\n    })\n  })\n]\n\n")),(0,o.kt)("p",null,"\u5982\u679c\u4ec5\u4ec5\u9700\u8981\u6709\u5185\u5bb9\u5373\u53ef\uff0c\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u9ed8\u8ba4\u5bfc\u51fa\u7684",(0,o.kt)("inlineCode",{parentName:"p"},"faker"),"\u5b9e\u4f8b"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"import { faker as mock } from '@faker-js/faker'\nimport createResponse from './createResponse'\n")))}u.isMDXComponent=!0}}]);